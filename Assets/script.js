// menu and game section
const menu = document.getElementById("menu");
const game = document.getElementById("game");
const gridElement = document.getElementById("grid");
const colorsElement = document.getElementById("colors");
const winMessage = document.getElementById("win-message");

// buttons
const toggleBtn = document.getElementById("toggle-numbers");
const resetBtn = document.getElementById("reset");

let currentPuzzle = null;
let currentColor = null;
let numbersVisible = true;

const puzzles = {
    easy: {
        palette: {
            1: "#ffd633",
            2: "#000000",
            3: "#ff3333",
            4: "#ffffff"
        },
        grid: [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,2,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0],
            [0,2,1,2,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0],
            [2,1,1,1,2,0,0,0,0,0,0,0,2,1,2,0,0,0,0],
            [2,1,1,1,1,2,2,2,0,0,0,0,2,1,1,2,0,0,0],
            [0,2,1,1,1,2,2,2,2,2,0,0,2,1,1,2,0,0,0],
            [0,0,2,1,1,1,2,2,1,1,2,2,1,1,1,1,2,0,0],
            [0,0,0,2,1,1,2,2,1,1,1,1,1,1,1,1,1,2,0],
            [0,0,2,1,1,2,0,2,1,1,1,1,1,1,1,1,1,4,2],
            [0,0,2,1,2,0,0,2,1,1,1,1,1,1,1,1,1,2,2],
            [0,0,0,2,1,2,2,1,1,1,1,1,2,4,1,1,1,1,2],
            [0,0,0,0,2,2,2,1,1,1,3,3,2,2,1,1,1,2,0],
            [0,0,0,0,0,2,2,2,1,1,1,3,1,1,1,1,2,0,0],
            [0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,2,0],
            [0,0,0,0,0,2,2,1,1,2,1,1,1,1,1,2,2,0,0],
            [0,0,0,0,0,2,1,1,1,1,2,1,1,1,1,2,0,0,0],
            [0,0,0,0,0,2,1,1,1,2,1,1,1,1,2,1,2,0,0],
            [0,0,0,0,0,0,2,1,1,1,1,1,2,2,2,2,2,0,0],
            [0,0,0,0,0,0,2,2,1,2,2,2,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,2,1,1,1,2,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ]
    },
    medium: {
            palette: {
            1: "#4FC3C0", // Light Teal
            2: "#1b9e9f", // Dark Teal
            3: "#1D6D6A", // Deep Teal
            4: "#A8D840", // Light Lime
            5: "#6BAf34", // Light Green
            6: "#3E6D24", // Dark Green
            7: "#ff7971", // Light Red
            8: "#d01940", // Dark Red
            9: "#000000", // Black
            10: "#ffffff" // White
    },

        grid: [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,4,9,9,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,6,6,6,6,4,5,5,6,5,9,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,4,4,4,4,4,4,4,4,4,5,4,6,5,9,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,4,4,4,4,4,4,4,5,5,4,4,5,6,9,0,0,0,0,0],
            [0,0,0,3,3,0,0,0,0,0,0,0,0,5,4,4,4,4,4,3,9,5,5,5,4,4,4,4,5,6,9,0,0,0,0,0],
            [0,0,2,1,1,3,3,0,2,2,2,2,2,2,2,2,2,3,3,1,1,9,4,4,4,4,4,4,4,6,5,9,0,0,0,0],
            [0,0,2,1,1,1,2,2,1,1,1,1,1,1,1,1,3,1,1,1,1,9,4,4,4,4,4,4,4,6,5,5,9,0,0,0],
            [0,0,2,1,2,1,1,1,1,1,2,2,2,1,1,1,1,1,1,1,1,9,4,4,4,4,4,4,5,5,6,5,9,0,0,0],
            [0,0,2,2,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,2,9,4,4,4,4,4,4,5,6,5,5,9,0,0],
            [0,0,2,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,2,9,4,4,4,4,4,4,5,5,6,5,9,0,0],
            [0,0,2,1,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,2,9,4,4,4,4,4,5,5,5,6,5,5,9,0],
            [0,2,3,1,1,1,1,1,1,1,1,1,1,1,1,3,10,10,3,1,2,2,2,9,4,4,4,5,5,5,5,6,5,5,9,0],
            [0,3,7,2,1,1,1,1,1,2,2,1,1,1,3,7,8,10,10,3,2,2,2,9,3,5,5,5,5,5,5,6,5,5,9,0],
            [0,3,7,2,1,1,1,1,2,2,2,1,1,1,3,7,8,10,10,3,2,2,2,9,3,5,5,5,5,5,6,5,5,5,9,0],
            [2,10,7,10,2,1,1,1,2,2,1,1,1,2,7,10,8,8,10,10,2,2,2,3,2,3,5,5,5,5,6,5,5,5,9,0],
            [2,10,8,10,2,1,1,1,1,1,1,1,1,2,8,10,7,7,10,10,2,2,2,3,2,2,3,5,5,6,5,5,5,9,0,0],
            [2,1,8,8,2,1,1,1,1,1,1,1,1,2,8,8,7,7,10,2,2,2,2,2,2,2,2,3,3,5,5,5,5,9,0,0],
            [3,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,5,5,9,0,0,0],
            [3,2,9,3,1,1,2,1,1,2,1,1,1,1,1,1,2,3,9,9,2,2,3,2,2,2,3,3,2,2,3,9,0,0,0,0],
            [0,3,2,10,8,8,1,1,1,1,1,2,3,9,9,9,10,3,2,2,2,2,3,2,2,2,3,3,3,2,2,3,0,0,0,0],
            [0,0,3,2,2,3,8,8,8,8,8,8,8,8,8,8,3,2,2,2,2,3,2,2,2,2,2,3,3,2,2,2,3,0,0,0],
            [0,0,0,9,9,2,2,3,8,8,7,7,7,7,3,2,2,2,2,9,9,2,2,2,2,2,3,2,2,2,2,2,3,0,0,0],
            [0,0,0,0,0,9,9,2,2,2,2,2,2,2,2,2,9,9,9,2,2,2,2,2,2,3,2,2,2,3,2,2,2,9,0,0],
            [0,0,0,0,0,3,2,9,9,9,9,9,9,9,9,9,2,2,2,2,2,2,3,2,2,9,2,2,3,3,3,2,2,9,0,0],
            [0,0,0,0,0,2,1,1,1,2,3,2,2,2,2,2,2,3,1,1,2,2,2,3,9,2,2,2,3,3,3,2,2,9,0,0],
            [0,0,0,0,0,0,3,2,1,1,2,3,9,2,2,2,3,2,2,1,1,2,2,3,9,2,2,2,3,3,3,2,2,9,0,0],
            [0,0,0,0,0,0,3,2,1,1,2,2,2,9,9,9,3,2,2,2,1,2,2,3,9,2,2,2,2,3,2,2,9,0,0,0],
            [0,0,0,0,0,0,2,1,1,1,1,2,2,9,0,0,2,1,2,2,1,2,2,3,0,9,2,2,2,2,2,2,9,0,0,0],
            [0,0,0,0,0,0,10,2,1,1,1,1,2,2,9,0,0,1,1,1,1,2,9,0,0,3,10,3,10,3,10,3,0,0,0,0],
            [0,0,0,0,0,0,3,10,3,10,3,2,9,0,0,0,3,1,2,1,2,2,9,0,0,0,9,9,9,9,9,0,0,0,0,0],
            [0,0,0,0,0,0,0,9,9,9,9,9,0,0,0,3,10,3,10,3,10,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],

    ]
    },
    hard: {
        palette: {
            1: "#c9a6d9",
            2: "#b07dc9",
            3: "#8c5fae",
            4: "#5b3b74",
            5: "#1d0019ff",
            6: "#ffffff",
            7: "#d62828",
            8: "#8b1a1a",
            9: "#1e3a8a",
            10: "#ebdbf3ff"
        },
        grid: [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,1,1,1,1,1,1,1,1,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,1,2,2,2,4,4,4,4,4,4,4,1,1,1,3,3,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,2,2,4,4,0,4,2,2,2,2,2,2,2,1,1,1,3,3,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,4,4,0,0,4,3,3,3,4,4,4,4,4,3,3,1,1,1,3,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,4,3,3,3,4,0,0,0,0,0,0,0,3,3,1,1,3,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,0,0,0,0,0,0,3,1,1,3,0,0,0,0,0],
            [0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,3,0,0,0,0],
            [0,3,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,0,0,0],
            [0,3,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,2,4,0,0],
            [0,3,2,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,2,4,0,0],
            [0,3,2,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,4,2,2,4,0],
            [0,5,2,1,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,2,2,3,0,0,0,0,0,0,0,0,0,0,4,2,3,4,0],
            [0,5,2,1,1,1,1,3,0,0,0,0,0,0,0,0,0,0,3,3,3,3,1,1,1,2,2,4,0,0,0,0,0,0,0,0,0,0,0,4,2,3,4,0],
            [0,0,5,2,1,1,1,1,3,0,0,0,0,0,0,0,3,3,1,1,1,1,1,2,2,5,5,4,0,0,0,0,0,0,0,0,0,0,0,4,2,3,4,0],
            [0,0,5,5,2,1,1,1,1,3,3,3,3,0,0,3,1,1,1,1,1,2,2,5,5,5,4,0,0,0,0,0,0,0,0,0,0,0,0,4,2,3,4,0],
            [0,0,4,5,2,1,1,3,3,1,1,1,1,3,3,1,1,1,2,2,2,5,5,5,5,4,4,0,0,0,0,0,0,0,0,0,0,0,4,2,2,4,0,0],
            [0,0,0,4,5,2,3,1,10,10,1,1,1,3,1,1,1,2,2,5,5,5,5,5,4,4,0,0,0,0,0,0,0,0,0,0,0,0,4,2,3,4,0,0],
            [0,0,0,4,5,3,1,10,10,10,10,1,1,1,1,1,1,3,5,5,5,5,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,4,2,2,3,4,0,0],
            [0,0,0,4,3,1,10,10,10,10,10,10,1,1,1,1,3,3,3,5,4,4,4,4,0,0,0,0,0,0,3,3,4,4,0,0,4,2,2,3,4,0,0,0],
            [0,0,0,0,3,10,10,10,10,10,10,10,1,1,1,1,4,4,4,4,4,4,4,0,0,0,0,3,3,1,1,1,2,4,4,2,2,3,4,0,0,0,0],
            [0,0,0,0,3,1,1,8,8,1,10,1,1,1,1,1,1,1,1,4,4,4,4,0,0,0,0,2,2,1,1,1,1,1,1,1,1,4,4,4,0,0,0,0,0],
            [0,0,0,3,1,8,6,7,8,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,2,1,1,1,1,1,1,1,1,1,1,1,5,4,0,0,0,0,0],
            [0,0,0,3,1,8,7,7,8,1,1,1,1,1,1,1,1,1,1,1,1,2,4,2,2,1,1,1,1,1,1,1,1,1,1,1,1,2,4,0,0,0,0,0],
            [0,0,0,3,1,1,8,8,1,1,1,5,5,1,1,1,2,1,1,1,1,1,1,4,2,2,2,1,1,1,1,1,1,1,1,1,1,2,4,0,0,0,0,0],
            [0,0,0,3,1,1,1,1,1,1,5,9,9,1,1,1,4,1,4,2,2,1,1,1,4,2,2,2,1,1,1,1,1,1,1,2,1,2,2,4,0,0,0,0],
            [0,0,0,3,1,1,1,1,1,5,6,9,9,1,1,1,4,4,1,4,2,2,2,2,2,4,2,2,1,2,1,1,1,1,2,1,2,2,2,4,0,0,0,0],
            [0,0,0,0,3,1,1,1,1,5,9,9,1,1,1,4,3,3,4,3,4,4,4,4,4,4,2,2,2,1,2,1,1,2,2,2,2,2,2,4,0,0,0,0],
            [0,0,0,0,3,1,1,1,1,1,1,1,1,1,4,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,0,0,0,0],
            [0,0,0,0,0,3,1,1,1,1,1,1,1,4,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,0,0,0,0],
            [0,0,0,0,0,0,3,3,3,3,3,4,4,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,3,1,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,3,2,2,2,2,2,2,2,4,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,3,1,1,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,3,2,2,2,2,2,2,2,4,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,3,1,4,2,2,2,2,2,2,2,2,4,2,2,2,3,3,4,4,3,2,2,2,2,2,2,2,4,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,4,1,4,2,2,2,2,2,2,2,2,4,3,3,3,4,4,3,3,4,3,2,2,2,2,2,2,2,4,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,4,4,3,1,1,1,2,2,2,2,4,4,4,4,4,3,3,3,3,3,4,2,2,2,2,2,2,2,4,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,4,3,1,1,1,1,2,2,2,4,0,0,0,0,4,3,3,3,3,3,4,4,2,2,2,2,2,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,2,2,2,4,0,0,0,0,0,0,4,4,3,3,3,4,0,4,4,4,2,2,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,2,2,2,4,0,0,0,0,0,0,0,0,0,0,4,3,3,3,4,0,0,0,4,2,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,3,1,2,2,2,4,4,2,4,0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,4,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,0,4,2,2,2,2,4,2,2,2,4,0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,4,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,0,4,2,2,2,4,0,4,2,2,2,4,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,4,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,4,2,2,2,4,0,0,4,2,2,2,4,0,0,0,0,0,0,0,0,4,2,2,3,4,0,0,0,0,4,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,4,2,2,2,4,0,0,4,2,2,2,4,0,0,0,0,0,0,0,4,2,2,2,3,4,0,0,0,4,2,2,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,3,1,2,4,0,0,0,4,2,2,2,4,0,0,0,0,0,0,4,2,3,2,2,4,0,0,0,0,4,1,3,2,4,0,0],
            [0,0,0,0,0,0,0,0,0,3,1,2,4,0,0,4,1,1,2,4,0,0,0,0,0,0,0,4,2,3,2,4,0,0,0,0,4,1,3,3,4,0,0,0],
            [0,0,0,0,0,0,0,0,0,3,1,2,4,0,0,4,2,4,2,4,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,4,2,3,3,4,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,3,4,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0],
        ]
    }
};

// Difficulty select menu
document.querySelectorAll("#menu button").forEach(button => {
    button.addEventListener("click", () => {
        const puzzleName = button.dataset.puzzle;
        currentPuzzle = puzzleName;
        winMessage.classList.add("hidden");
        renderPalette(puzzles[puzzleName].palette);
        renderGrid(puzzles[puzzleName]);
        menu.classList.add("hidden");
        game.classList.remove("hidden");
        resetBtn.classList.remove("hidden");
        toggleBtn.classList.remove("hidden");
        returnBtn.classList.remove("hidden");
    });
});

function renderPalette(palette) {
    colorsElement.innerHTML = "";
    Object.entries(palette).forEach(([num, color]) => {
        const swatch = document.createElement("div");
        swatch.className = "swatch";
        swatch.style.backgroundColor = color;
        swatch.dataset.num = num;
        swatch.textContent = num;
        swatch.addEventListener("click", () => {
            currentColor = num;
            document.querySelectorAll(".swatch").forEach(s => s.classList.remove("selected"));
            swatch.classList.add("selected");
        });
        colorsElement.appendChild(swatch);
    });
}

function renderGrid(puzzle) {
    gridElement.innerHTML = "";
    gridElement.style.display = "grid";
    gridElement.style.gridTemplateColumns = `repeat(${puzzle.grid[0].length}, 20px)`;

    puzzle.grid.forEach((row, y) => {
        row.forEach((cell, x) => {
            const cellDiv = document.createElement("div");
            cellDiv.classList.add("cell");
            cellDiv.dataset.correct = cell;
            cellDiv.dataset.y = y;
            cellDiv.dataset.x = x;
            cellDiv.dataset.filled = "false";
            cellDiv.style.backgroundColor = ""; // reset color

            if (cell !== 0 && numbersVisible) {
                cellDiv.textContent = cell;
            }
            gridElement.appendChild(cellDiv);
        });
    });
}

gridElement.addEventListener("click", e => {
    const cell = e.target;
    if (!cell.classList.contains("cell")) return;
    const correctNum = cell.dataset.correct;
    if (correctNum === "0" || !currentColor) return;

    cell.style.backgroundColor = puzzles[currentPuzzle].palette[currentColor];
    cell.textContent = "";

    if (currentColor === correctNum) {
        cell.dataset.filled = "true";
        checkWin();
    } else {
        cell.dataset.filled = "false";
    }
});

resetBtn.addEventListener("click", () => {
    renderGrid(puzzles[currentPuzzle]);
});

toggleBtn.addEventListener("click", () => {
    numbersVisible = !numbersVisible;
    document.querySelectorAll(".cell").forEach(cell => {
        if (cell.dataset.correct !== "0" && cell.dataset.filled !== "true") {
            cell.textContent = numbersVisible ? cell.dataset.correct : "";
        }
    });
    document.body.classList.toggle("free-draw", !numbersVisible);
});

function checkWin() {
    // All non-zero cells must be filled correctly
    const cells = gridElement.querySelectorAll(".cell");
    let allCorrect = true;
    cells.forEach(cell => {
        if (cell.dataset.correct !== "0" && cell.dataset.filled !== "true") {
            allCorrect = false;
        }
    });
    if (allCorrect) {
        winMessage.classList.remove("hidden");
    }
}

const returnBtn = document.getElementById("return");

returnBtn.addEventListener("click", () => {
    game.classList.add("hidden");
    menu.classList.remove("hidden");
    winMessage.classList.add("hidden");
    resetBtn.classList.add("hidden");
    toggleBtn.classList.add("hidden");
    returnBtn.classList.add("hidden");
    gridElement.innerHTML = "";
    colorsElement.innerHTML = "";
    currentPuzzle = null;
    currentColor = null;
});